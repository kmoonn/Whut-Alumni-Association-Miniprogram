<!-- 顶部栏 -->
<view class="top-bar">
  <text class="title">校友确认记录</text>
</view>

<!-- 搜索区域 -->
<view class="search-section">
  <input class="search-input" placeholder="请输入校友姓名搜索" bindinput="onSearchInput" value="{{searchName}}" />
  <button class="search-btn" bindtap="onSearch">搜索</button>
</view>

<!-- 历史记录列表 -->
<scroll-view scroll-y class="record-list" bindscrolltolower="loadMore" lower-threshold="50">

  <block wx:for="{{records}}" wx:key="id">
    <view class="record-card" bindtap="viewDetail" data-item="{{item}}">
      
      <view class="record-header">
        <text class="record-name">{{item.name}}</text>
        <view class="tag {{item.result === '是校友' ? 'tag-yes' : item.result === '非校友' ? 'tag-no' : 'tag-unknown'}}">
          {{item.result}}
        </view>
      </view>

      <view class="record-body">
        <text class="info">所在单位：{{item.department}}</text>
        <text class="date">确认日期：{{item.date}}</text>
      </view>

    </view>
  </block>

  <view wx:if="{{records.length === 0 && !loading}}" class="no-data">
    <text>暂无匹配记录</text>
  </view>

  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:if="{{noMore}}" class="no-more">
    <text>暂无更多记录</text>
  </view>

</scroll-view>


<t-dialog 
  visible="{{showDetail}}" 
  confirm-btn="提交修改" 
  cancel-btn="关闭" 
  bind:confirm="submitUpdate" 
  bind:cancel="closeDetail"
  class="detail-dialog"
>
  <scroll-view slot="content" scroll-y class="detail-scroll">

    <!-- 基础信息 -->
    <view class="info-section">
      <view class="section-title">基础信息</view>
      <view class="column-item"><text class="label">姓名：</text><text class="value">{{detail.name}}</text></view>
      <view class="column-item"><text class="label">性别：</text><text class="value">{{detail.sex || '未知'}}</text></view>
      <view class="column-item"><text class="label">毕业年份：</text><text class="value">{{detail.graduation_year || '未知'}}</text></view>
      <view class="column-item"><text class="label">学院：</text><text class="value">{{detail.department || '未知'}}</text></view>
      <view class="column-item"><text class="label">专业：</text><text class="value">{{detail.major || '未知'}}</text></view>
      <view class="column-item"><text class="label">公司：</text><text class="value">{{detail.company || '未知'}}</text></view>
      <view class="column-item"><text class="label">职位：</text><text class="value">{{detail.position || '未知'}}</text></view>
      <view class="column-item"><text class="label">地区：</text><text class="value">{{detail.region || '未知'}}</text></view>
    </view>

    <!-- 校友库源信息 -->
    <view class="info-section">
      <view class="section-title">校友库源信息</view>
      <block wx:if="{{sourceInfo}}">
        <view class="column-item"><text class="label">姓名：</text><text class="value">{{sourceInfo.source_name}}</text></view>
        <view class="column-item"><text class="label">性别：</text><text class="value">{{sourceInfo.source_sex || '未知'}}</text></view>
        <view class="column-item"><text class="label">学院：</text><text class="value">{{sourceInfo.source_department}}</text></view>
        <view class="column-item"><text class="label">专业：</text><text class="value">{{sourceInfo.source_major}}</text></view>
        <view class="column-item"><text class="label">毕业年份：</text><text class="value">{{sourceInfo.source_graduation_year}}</text></view>
        <view class="column-item"><text class="label">公司：</text><text class="value">{{sourceInfo.source_company || '未知'}}</text></view>
        <view class="column-item"><text class="label">职位：</text><text class="value">{{sourceInfo.source_position || '未知'}}</text></view>
        <view class="column-item"><text class="label">地区：</text><text class="value">{{sourceInfo.source_region || '无'}}</text></view>
      </block>
      <block wx:else>
        <view class="no-source">暂无校友库源信息</view>
      </block>
    </view>

    <!-- 修改区域 -->
    <view class="modify-section">
      <view class="section-title">修改确认结果</view>
      <view class="picker" bindtap="chooseResult">
        当前：<text class="highlight">{{updateResult || '请选择'}}</text>
      </view>

      <view class="section-title">选择理由（可选）</view>
      <view class="picker" bindtap="chooseReason">
        <text class="highlight">{{selectedReason || '请选择理由'}}</text>
      </view>
    </view>

  </scroll-view>
</t-dialog>